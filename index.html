<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COMCAM Quote Request</title>
    
    <!-- PWA Metadata -->
    <meta name="description" content="Request a quote for professional video production services">
    <meta name="theme-color" content="#2a5298">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="COMCAM Quote">
    
    <!-- html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK v9 (compat mode for easier usage) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #2a5298;
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .info-banner {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 2px solid #2a5298;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .info-banner h3 {
            color: #1e3c72;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-banner p {
            color: #1e3c72;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .info-banner p:last-child {
            margin-bottom: 0;
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }
        
        .disclaimer p {
            color: #856404;
            font-size: 13px;
            line-height: 1.6;
            margin: 0;
        }
        
        .error-message, .success-message {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-size: 16px;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .error-message {
            background: #f8d7da;
            border: 3px solid #dc3545;
            color: #721c24;
        }
        
        .success-message {
            background: #d4edda;
            border: 3px solid #28a745;
            color: #155724;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .success-message strong {
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }
        
        .error-message.show, .success-message.show {
            display: block;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2a5298;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a5298;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 15px;
        }
        
        label .required {
            color: #e74c3c;
        }
        
        label .price-note {
            font-weight: normal;
            color: #666;
            font-size: 13px;
        }
        
        select, input[type="number"], input[type="text"], input[type="email"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
        }
        
        select:disabled, input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        small {
            color: #666;
            font-size: 12px;
            display: block;
            margin-top: 5px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }
        
        .checkbox-item.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            margin: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        .sub-input {
            margin-left: 30px;
            margin-top: 10px;
            display: none;
        }
        
        .sub-input.show {
            display: block;
        }
        
        .price-display {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin: 25px 0;
        }
        
        .price-display h3 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .price-display .price {
            font-size: 42px;
            font-weight: bold;
        }
        
        .btn-primary {
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #218838;
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .itemized-list {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .itemized-list h4 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .itemized-list ul {
            list-style: none;
            padding: 0;
        }
        
        .itemized-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .itemized-list li:last-child {
            border-bottom: none;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .firebase-status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 13px;
            text-align: center;
        }
        
        .firebase-status.connected {
            background: #d4edda;
            color: #155724;
        }
        
        .firebase-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        @media (max-width: 768px) {
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ COMCAM Video Production</h1>
            <p>Request a custom quote for your project</p>
        </div>
        
        <div class="content">
            <div class="info-banner">
                <h3>üì¶ Filming Services Include Free Hard Drive!</h3>
                <p><strong>When you book filming services,</strong> we'll provide all raw 4K footage on a complimentary hard drive at no extra cost. This ensures you have full access to all source materials from your shoot.</p>
            </div>
            
            <div class="disclaimer">
                <p>‚ö†Ô∏è <strong>Important:</strong> All quote requests go through a consultation process for verification of services and project planning. This ensures we fully understand your needs and can deliver the best results for your project.</p>
                <p style="margin-top: 10px;">üí∞ <strong>Pricing Note:</strong> The estimates shown are baseline rates. Final pricing may vary based on project complexity, timeline requirements, and our working relationship. We're happy to discuss pricing details during our consultation!</p>
            </div>
            
            <div id="firebaseStatus" class="firebase-status disconnected">
                üî¥ Connecting to server...
            </div>
            
            <div id="errorMessage" class="error-message">
                <strong>‚ùå Submission Error</strong>
                <p id="errorText"></p>
            </div>
            
            <div id="successMessage" class="success-message">
                <strong>üéâ Request Submitted Successfully!</strong>
                <p>Thank you! We've received your quote request and will review it shortly. You'll hear from us soon to discuss your project and finalize the details.</p>
            </div>
            
            <form id="quoteForm">
                <!-- Your Information Section -->
                <div class="section">
                    <h2 class="section-title">üìã Your Information</h2>
                    
                    <div class="form-group">
                        <label>Name <span class="required">*</span></label>
                        <input type="text" id="clientName" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Email <span class="required">*</span></label>
                        <input type="email" id="clientEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Project Name <span class="required">*</span></label>
                        <input type="text" id="projectName" placeholder="e.g., Company Promo Video" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Project Description (Optional)</label>
                        <textarea id="projectDescription" placeholder="Tell us about your project..."></textarea>
                    </div>
                </div>
                
                <!-- Filming Services -->
                <div class="section">
                    <h2 class="section-title">üé• Filming Services</h2>
                    
                    <div class="form-group">
                        <label>Filming Rate Type <span class="required">*</span></label>
                        <select id="filmingRateType">
                            <option value="none">Post-Production Only (I have footage)</option>
                            <option value="daily">Daily Rate (Best for 4+ hours or multi-day)</option>
                            <option value="hourly">Hourly Rate (Short projects)</option>
                        </select>
                    </div>
                    
                    <div id="filmingOptions" class="sub-input">
                        <div class="form-group">
                            <label id="filmingDurationLabel">Duration</label>
                            <input type="number" id="filmingDuration" min="1" step="1" value="1">
                            <small id="filmingDurationHelp"></small>
                        </div>
                        
                        <div class="form-group">
                            <label>Location Type <span class="price-note">(Daily: +$0 local / +$250 travel | Hourly: +$0 local / +$100 travel)</span></label>
                            <select id="filmingLocation">
                                <option value="local">Local (within 30 miles)</option>
                                <option value="travel">Travel Required (30+ miles)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Estimated Raw Footage (minutes) <span class="price-note">For hard drive prep</span></label>
                            <input type="number" id="rawFootageMinutes" min="0" step="15" value="60">
                            <small>Average: 30-60 min per hour of filming. Used to estimate hard drive size.</small>
                        </div>
                        
                        <!-- Bulk Filming Rates Info -->
                        <div class="info-banner" style="margin-top: 15px;">
                            <h3>üí∞ Daily Rate Bulk Pricing</h3>
                            <p><strong>Single days:</strong> $650/day</p>
                            <p><strong>Weekly rate (5-6 days):</strong> $3,000/week (~$600/day - saves $250-$400)</p>
                            <p><strong>Monthly rate (20-30 days):</strong> $10,000/month (~$400/day - saves $5,000+)</p>
                            <p style="margin-top: 10px;"><strong>Example project:</strong> 2-week trip (14 days) = 2 weeks √ó $3,000 + 4 days √ó $650 = $8,600</p>
                        </div>
                        
                        <!-- Multi-Day Planning Guide -->
                        <div class="info-banner" style="margin-top: 15px; background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%); border-color: #ffc107;">
                            <h3>üìÖ Planning a Multi-Day Shoot?</h3>
                            <p><strong>Example:</strong> A 2-week filming trip (14 days including travel) with 8 hours of raw footage, producing 5 two-minute final videos with voiceover, music, and animations.</p>
                            <p><strong>How to quote:</strong> Set Duration to 14 days, Raw Footage to 480 minutes (8 hours), then in Post-Production set Video Duration to 10 minutes (5 videos √ó 2 min each) and enable the services you need.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Post-Production Services -->
                <div class="section">
                    <h2 class="section-title">‚úÇÔ∏è Post-Production Services</h2>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="timelineEditingEnabled">
                        <label for="timelineEditingEnabled">Enable Timeline Editing</label>
                    </div>
                    
                    <div id="editingOptions" class="sub-input">
                        <div class="form-group">
                            <label>Video Duration (minutes) <span class="price-note">($150/min base editing rate)</span></label>
                            <input type="number" id="duration" min="0.25" step="0.25" value="2">
                            <small>For multiple videos, enter the combined duration (e.g., 5 videos √ó 2 min = 10 minutes)</small>
                        </div>
                        
                        <label>Additional Services:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="basicColor">
                                <label for="basicColor">Basic Color Correction ($15/min)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="advancedColor">
                                <label for="advancedColor">Advanced Color Grading ($35/min)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="fxWork">
                                <label for="fxWork">Visual Effects ($65/min)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="audioMixing">
                                <label for="audioMixing">Audio Mixing ($45/min)</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="soundDesign">
                                <label for="soundDesign">Sound Design/SFX ($150 flat)</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Motion Graphics -->
                    <div class="checkbox-item" style="margin-top: 15px;">
                        <input type="checkbox" id="motionGraphics">
                        <label for="motionGraphics">Motion Graphics / Lower Thirds / Animations</label>
                    </div>
                    
                    <div id="motionGraphicsOptions" class="sub-input">
                        <div class="form-group">
                            <label>Total Animated Duration (seconds)</label>
                            <input type="number" id="graphicsDuration" min="1" step="1" value="30">
                            <small>Sum of all animated elements (titles, lower thirds, transitions, etc.)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Complexity Level</label>
                            <select id="graphicsComplexity">
                                <option value="simple">Simple ($15/sec) - Lower thirds, basic titles, simple text animations</option>
                                <option value="moderate">Moderate ($35/sec) - Animated logos, kinetic typography, basic infographics</option>
                                <option value="complex">Complex ($65/sec) - Photo montages, 3D animation, character animation, fully animated sequences</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Music Composition -->
                    <div class="checkbox-item" style="margin-top: 15px;">
                        <input type="checkbox" id="musicComposition">
                        <label for="musicComposition">Original Music Composition</label>
                    </div>
                    
                    <div id="musicOptions" class="sub-input">
                        <div class="form-group">
                            <label>Music Type</label>
                            <select id="musicType">
                                <option value="musicBed">Music Bed - Background Score ($200)</option>
                                <option value="jingle">Jingle - Short Branded Tune ($500)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Voiceover -->
                    <div class="checkbox-item" style="margin-top: 15px;">
                        <input type="checkbox" id="voiceover">
                        <label for="voiceover">Professional Voiceover/Narration</label>
                    </div>
                    
                    <div id="voiceoverOptions" class="sub-input">
                        <div class="form-group">
                            <label>Voiceover Coverage ($300/min of video)</label>
                            <select id="voiceoverCoverage">
                                <option value="full">Full Coverage - Voiceover throughout entire video</option>
                                <option value="partial">Partial Coverage - ~50% of video</option>
                            </select>
                            <small>Rate is based on video duration, not script length. Professional voiceover talent at competitive rates (~70% of national union scale).</small>
                        </div>
                    </div>
                </div>
                
                <!-- Priority Service -->
                <div class="section">
                    <h2 class="section-title">‚ö° Priority Service</h2>
                    
                    <div class="checkbox-item">
                        <input type="checkbox" id="fastLane">
                        <label for="fastLane">
                            <strong>Fast Lane / Rush Delivery (+30%)</strong><br>
                            <small>Move to front of production queue for faster turnaround</small>
                        </label>
                    </div>
                </div>
                
                <!-- Price Display -->
                <div class="price-display">
                    <h3>Estimated Total</h3>
                    <div class="price">$<span id="totalPrice">0</span></div>
                    <small style="opacity: 0.8; display: block; margin-top: 10px;">Final quote subject to consultation</small>
                </div>
                
                <!-- Itemized Breakdown -->
                <div class="itemized-list">
                    <h4>üìä Itemized Breakdown</h4>
                    <ul id="itemizedBreakdown">
                        <li><span>No services selected</span><span>$0</span></li>
                    </ul>
                </div>
                
                <button type="submit" class="btn-primary" id="submitBtn">Submit Request</button>
            </form>
        </div>
    </div>
    
    <script>
        // ========================================
        // FIREBASE CONFIGURATION
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSybSLjuPp5h8K6DOnrIGL4iWDUNJC-YVXoY",
            authDomain: "comcam-dashboard.firebaseapp.com",
            databaseURL: "https://comcam-dashboard-default-rtdb.firebaseio.com",
            projectId: "comcam-dashboard",
            storageBucket: "comcam-dashboard.firebasestorage.app",
            messagingSenderId: "102412134495",
            appId: "1:102412134495:web:dc80978df11e1c569093ea"
        };
        
        // Initialize Firebase
        let database = null;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            
            // Test connection
            database.ref('.info/connected').on('value', function(snapshot) {
                const statusEl = document.getElementById('firebaseStatus');
                if (snapshot.val() === true) {
                    statusEl.textContent = 'üü¢ Connected to server';
                    statusEl.className = 'firebase-status connected';
                } else {
                    statusEl.textContent = 'üü° Reconnecting...';
                    statusEl.className = 'firebase-status disconnected';
                }
            });
        } catch (error) {
            console.error('Firebase initialization error:', error);
            document.getElementById('firebaseStatus').textContent = 'üî¥ Server connection unavailable - Please check configuration';
        }
        
        // ========================================
        // UI LOGIC
        // ========================================
        
        // Filming options toggle
        document.getElementById('filmingRateType').addEventListener('change', function() {
            const filmingOptions = document.getElementById('filmingOptions');
            const rateType = this.value;
            const durationLabel = document.getElementById('filmingDurationLabel');
            const durationInput = document.getElementById('filmingDuration');
            const durationHelp = document.getElementById('filmingDurationHelp');
            
            if (rateType === 'none') {
                filmingOptions.classList.remove('show');
            } else {
                filmingOptions.classList.add('show');
                
                if (rateType === 'daily') {
                    durationLabel.textContent = 'Number of Days';
                    durationInput.value = 1;
                    durationInput.step = 1;
                    durationHelp.textContent = '$650 per day (up to 8 hours). Best for multi-day shoots or 4+ hour days.';
                } else {
                    durationLabel.textContent = 'Number of Hours';
                    durationInput.value = 2;
                    durationInput.step = 0.5;
                    durationHelp.textContent = '$200 per hour. Best for short projects under 4 hours.';
                }
            }
        });
        
        // Timeline editing toggle
        document.getElementById('timelineEditingEnabled').addEventListener('change', function() {
            const editingOptions = document.getElementById('editingOptions');
            editingOptions.classList.toggle('show', this.checked);
        });
        
        // Motion graphics toggle
        document.getElementById('motionGraphics').addEventListener('change', function() {
            const options = document.getElementById('motionGraphicsOptions');
            options.classList.toggle('show', this.checked);
        });
        
        // Music composition toggle
        document.getElementById('musicComposition').addEventListener('change', function() {
            const options = document.getElementById('musicOptions');
            options.classList.toggle('show', this.checked);
        });
        
        // Voiceover toggle
        document.getElementById('voiceover').addEventListener('change', function() {
            const options = document.getElementById('voiceoverOptions');
            options.classList.toggle('show', this.checked);
        });
        
        // ========================================
        // PRICE CALCULATION
        // ========================================
        
        function updateItemizedList() {
            const breakdown = [];
            const filmingRateType = document.getElementById('filmingRateType').value;
            
            // Filming costs
            if (filmingRateType !== 'none') {
                const duration = parseFloat(document.getElementById('filmingDuration').value) || 0;
                const location = document.getElementById('filmingLocation').value;
                
                if (filmingRateType === 'daily') {
                    // Calculate bulk pricing breakdown
                    let remainingDays = duration;
                    let filmingTotal = 0;
                    const breakdown_parts = [];
                    
                    // Monthly rate
                    const monthlyDays = Math.floor(remainingDays / 30);
                    if (monthlyDays > 0) {
                        const monthlyCost = monthlyDays * 10000;
                        filmingTotal += monthlyCost;
                        breakdown_parts.push(`${monthlyDays} month(s) @ $10,000/month`);
                        remainingDays -= monthlyDays * 30;
                    }
                    
                    // Weekly rate
                    const weeklyDays = Math.floor(remainingDays / 5);
                    if (weeklyDays > 0) {
                        const weeklyCost = weeklyDays * 3000;
                        filmingTotal += weeklyCost;
                        breakdown_parts.push(`${weeklyDays} week(s) @ $3,000/week`);
                        remainingDays -= weeklyDays * 5;
                    }
                    
                    // Daily rate
                    if (remainingDays > 0) {
                        const dailyCost = remainingDays * 650;
                        filmingTotal += dailyCost;
                        breakdown_parts.push(`${remainingDays} day(s) @ $650/day`);
                    }
                    
                    const breakdown_text = breakdown_parts.join(' + ');
                    
                    // Travel fees
                    const travelFee = location === 'travel' ? duration * 250 : 0;
                    const finalFilmingTotal = filmingTotal + travelFee;
                    
                    breakdown.push({
                        label: `Filming (${duration} days total): ${breakdown_text}${location === 'travel' ? ' + $' + travelFee + ' travel' : ''}`,
                        amount: finalFilmingTotal
                    });
                } else {
                    const hourlyRate = 200;
                    const travelFee = location === 'travel' ? 100 : 0;
                    const filmingTotal = (duration * hourlyRate) + travelFee;
                    breakdown.push({
                        label: `Filming: ${duration} hour(s) @ $${hourlyRate}/hr ${location === 'travel' ? '+ $' + travelFee + ' travel' : ''}`,
                        amount: filmingTotal
                    });
                }
                
                // Hard drive note
                const rawFootage = parseInt(document.getElementById('rawFootageMinutes').value) || 0;
                const estimatedGB = Math.round(rawFootage * 4);
                breakdown.push({
                    label: `üì¶ Complimentary Hard Drive (~${estimatedGB}GB raw footage)`,
                    amount: 0,
                    isFree: true
                });
            }
            
            // Editing costs
            if (document.getElementById('timelineEditingEnabled').checked) {
                const duration = parseFloat(document.getElementById('duration').value) || 0;
                if (duration > 0) {
                    breakdown.push({
                        label: `Timeline Editing: ${duration} min @ $150/min`,
                        amount: duration * 150
                    });
                    
                    if (document.getElementById('basicColor').checked) {
                        breakdown.push({
                            label: `Basic Color Correction: ${duration} min @ $15/min`,
                            amount: duration * 15
                        });
                    }
                    
                    if (document.getElementById('advancedColor').checked) {
                        breakdown.push({
                            label: `Advanced Color Grading: ${duration} min @ $35/min`,
                            amount: duration * 35
                        });
                    }
                    
                    if (document.getElementById('fxWork').checked) {
                        breakdown.push({
                            label: `Visual Effects: ${duration} min @ $65/min`,
                            amount: duration * 65
                        });
                    }
                    
                    if (document.getElementById('audioMixing').checked) {
                        breakdown.push({
                            label: `Audio Mixing: ${duration} min @ $45/min`,
                            amount: duration * 45
                        });
                    }
                    
                    if (document.getElementById('soundDesign').checked) {
                        breakdown.push({
                            label: 'Sound Design/SFX',
                            amount: 150
                        });
                    }
                }
            }
            
            // Motion graphics
            if (document.getElementById('motionGraphics').checked) {
                const graphicsDuration = parseInt(document.getElementById('graphicsDuration').value) || 0;
                const complexity = document.getElementById('graphicsComplexity').value;
                const rates = { simple: 15, moderate: 35, complex: 65 };
                breakdown.push({
                    label: `Motion Graphics: ${graphicsDuration}sec @ $${rates[complexity]}/sec (${complexity})`,
                    amount: graphicsDuration * rates[complexity]
                });
            }
            
            // Music
            if (document.getElementById('musicComposition').checked) {
                const musicType = document.getElementById('musicType').value;
                const amount = musicType === 'jingle' ? 500 : 200;
                const label = musicType === 'jingle' ? 'Music Composition - Jingle' : 'Music Composition - Music Bed';
                breakdown.push({
                    label: label,
                    amount: amount
                });
            }
            
            // Voiceover
            if (document.getElementById('voiceover').checked) {
                const duration = parseFloat(document.getElementById('duration').value) || 0;
                const coverage = document.getElementById('voiceoverCoverage').value;
                const multiplier = coverage === 'full' ? 1 : 0.5;
                const amount = duration * 300 * multiplier;
                breakdown.push({
                    label: `Voiceover: ${coverage === 'full' ? 'Full' : 'Partial'} coverage (${duration * multiplier} min @ $300/min)`,
                    amount: amount
                });
            }
            
            // Calculate subtotal
            const subtotal = breakdown.reduce((sum, item) => sum + (item.amount || 0), 0);
            
            // Fast Lane
            if (document.getElementById('fastLane').checked && subtotal > 0) {
                const fastLaneFee = subtotal * 0.30;
                breakdown.push({
                    label: '‚ö° Fast Lane / Priority Service (+30%)',
                    amount: fastLaneFee,
                    isModifier: true
                });
            }
            
            // Update UI
            const listEl = document.getElementById('itemizedBreakdown');
            if (breakdown.length === 0) {
                listEl.innerHTML = '<li><span>No services selected</span><span>$0</span></li>';
            } else {
                listEl.innerHTML = breakdown.map(item => {
                    const amountText = item.isFree ? 'FREE' : `$${item.amount.toLocaleString()}`;
                    const style = item.isModifier ? 'color: #28a745; font-weight: 600;' : (item.isFree ? 'color: #28a745;' : '');
                    return `<li><span>${item.label}</span><span style="${style}">${amountText}</span></li>`;
                }).join('');
            }
        }
        
        function calculatePrice() {
            let basePrice = 0;
            
            // Filming
            const filmingRateType = document.getElementById('filmingRateType').value;
            if (filmingRateType !== 'none') {
                const duration = parseFloat(document.getElementById('filmingDuration').value) || 0;
                const location = document.getElementById('filmingLocation').value;
                
                if (filmingRateType === 'daily') {
                    // Bulk pricing tiers for daily rates
                    let filmingCost = 0;
                    let remainingDays = duration;
                    
                    // Monthly rate: $10,000 per 30 days
                    const monthlyDays = Math.floor(remainingDays / 30);
                    if (monthlyDays > 0) {
                        filmingCost += monthlyDays * 10000;
                        remainingDays -= monthlyDays * 30;
                    }
                    
                    // Weekly rate: $3,000 per 5-6 days (we'll use 5 for calculation)
                    const weeklyDays = Math.floor(remainingDays / 5);
                    if (weeklyDays > 0) {
                        filmingCost += weeklyDays * 3000;
                        remainingDays -= weeklyDays * 5;
                    }
                    
                    // Daily rate: $650 per remaining day
                    if (remainingDays > 0) {
                        filmingCost += remainingDays * 650;
                    }
                    
                    basePrice += filmingCost;
                    
                    // Travel fees (per day of actual filming)
                    if (location === 'travel') {
                        basePrice += duration * 250;
                    }
                } else {
                    // Hourly rate
                    basePrice += duration * 200;
                    if (location === 'travel') basePrice += 100;
                }
            }
            
            // Editing
            if (document.getElementById('timelineEditingEnabled').checked) {
                const duration = parseFloat(document.getElementById('duration').value) || 0;
                basePrice += duration * 150;
                
                if (document.getElementById('basicColor').checked) basePrice += duration * 15;
                if (document.getElementById('advancedColor').checked) basePrice += duration * 35;
                if (document.getElementById('fxWork').checked) basePrice += duration * 65;
                if (document.getElementById('audioMixing').checked) basePrice += duration * 45;
                if (document.getElementById('soundDesign').checked) basePrice += 150;
            }
            
            // Motion graphics
            if (document.getElementById('motionGraphics').checked) {
                const graphicsDuration = parseInt(document.getElementById('graphicsDuration').value) || 0;
                const graphicsComplexity = document.getElementById('graphicsComplexity').value;
                const rates = { simple: 15, moderate: 35, complex: 65 };
                basePrice += graphicsDuration * rates[graphicsComplexity];
            }
            
            // Music
            if (document.getElementById('musicComposition').checked) {
                const musicType = document.getElementById('musicType').value;
                basePrice += musicType === 'jingle' ? 500 : 200;
            }
            
            // Voiceover
            if (document.getElementById('voiceover').checked) {
                const duration = parseFloat(document.getElementById('duration').value) || 0;
                const voiceoverCoverage = document.getElementById('voiceoverCoverage').value;
                if (voiceoverCoverage === 'full') {
                    basePrice += duration * 300;
                } else {
                    basePrice += (duration * 0.5) * 300;
                }
            }
            
            // Fast Lane (+30%)
            if (document.getElementById('fastLane').checked) {
                basePrice = basePrice * 1.30;
            }
            
            // Round and display
            const finalPrice = basePrice >= 50 ? Math.round(basePrice / 50) * 50 : Math.round(basePrice);
            document.getElementById('totalPrice').textContent = finalPrice.toLocaleString();
        }
        
        // Initialize
        calculatePrice();
        updateItemizedList();
        
        // Auto-update on changes
        document.getElementById('quoteForm').addEventListener('change', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        document.getElementById('quoteForm').addEventListener('input', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        // ========================================
        // FORM SUBMISSION
        // ========================================
        
        document.getElementById('quoteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            // Hide messages
            successMsg.classList.remove('show');
            errorMsg.classList.remove('show');
            
            // Validate
            const clientName = document.getElementById('clientName').value.trim();
            const clientEmail = document.getElementById('clientEmail').value.trim();
            const projectName = document.getElementById('projectName').value.trim();
            
            if (!clientName || !clientEmail || !projectName) {
                document.getElementById('errorText').textContent = 'Please fill in all required fields (*)';
                errorMsg.classList.add('show');
                return;
            }
            
            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading-spinner"></div> Submitting...';
            
            try {
                // Check Firebase connection
                if (!database) {
                    throw new Error('Firebase not initialized. Please check your configuration.');
                }
                
                // Generate invoice number
                const now = new Date();
                const year = String(now.getFullYear()).slice(-2);
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const invoiceNumber = `${year}${month}${day}-${hours}${minutes}`;
                
                // Build description
                const services = [];
                
                const filmingRateType = document.getElementById('filmingRateType').value;
                const timelineEditingEnabled = document.getElementById('timelineEditingEnabled').checked;
                const videoDuration = timelineEditingEnabled ? (parseFloat(document.getElementById('duration').value) || 0) : 0;
                
                if (filmingRateType === 'none') {
                    services.push('Filming: Post-Production Only (Client providing footage)');
                } else if (filmingRateType === 'daily') {
                    const filmingDuration = document.getElementById('filmingDuration').value;
                    services.push(`Filming: ${filmingDuration} day(s) - ${document.getElementById('filmingLocation').value} location`);
                    const rawFootage = document.getElementById('rawFootageMinutes').value;
                    services.push(`Raw Footage: ${rawFootage} minutes (~${Math.round(rawFootage * 4)}GB)`);
                } else {
                    services.push(`Filming: ${document.getElementById('filmingDuration').value} hours - ${document.getElementById('filmingLocation').value} location`);
                    const rawFootage = document.getElementById('rawFootageMinutes').value;
                    services.push(`Raw Footage: ${rawFootage} minutes (~${Math.round(rawFootage * 4)}GB)`);
                }
                
                if (videoDuration > 0) services.push(`Video Duration: ${videoDuration} minutes`);
                if (document.getElementById('basicColor').checked) services.push('Basic Color Correction');
                if (document.getElementById('advancedColor').checked) services.push('Advanced Color Grading');
                if (document.getElementById('fxWork').checked) services.push('Visual Effects');
                if (document.getElementById('motionGraphics').checked) services.push(`Motion Graphics (${document.getElementById('graphicsDuration').value}s, ${document.getElementById('graphicsComplexity').value})`);
                if (document.getElementById('audioMixing').checked) services.push('Audio Mixing/Mastering');
                if (document.getElementById('soundDesign').checked) services.push('Sound Design/SFX');
                if (document.getElementById('musicComposition').checked) {
                    const musicType = document.getElementById('musicType').value;
                    services.push(musicType === 'jingle' ? 'Music Composition - Jingle' : 'Music Composition - Music Bed');
                }
                if (document.getElementById('voiceover').checked) {
                    const coverage = document.getElementById('voiceoverCoverage').value;
                    services.push(coverage === 'full' ? 'Voiceover/Narration - Full Coverage' : 'Voiceover/Narration - Partial Coverage');
                }
                
                const isFastLane = document.getElementById('fastLane').checked;
                const fastLaneText = isFastLane ? '\n\n‚ö° FAST LANE / PRIORITY SERVICE (+30%)\nRUSH DELIVERY - Move to front of production line' : '';
                
                const description = [
                    document.getElementById('projectDescription').value || '',
                    '',
                    'Services Requested:',
                    ...services.map(s => `‚Ä¢ ${s}`),
                    fastLaneText,
                    '',
                    `Client Email: ${clientEmail}`
                ].filter(Boolean).join('\n');
                
                // Prepare data
                const quoteData = {
                    task: projectName,
                    clientName: clientName,
                    person: '',
                    status: 'Not started',
                    priority: isFastLane ? 'High' : 'Standard',
                    requestDate: new Date().toISOString().split('T')[0],
                    dueDate: '',
                    actualWorkHours: '0',
                    workHours: '0',
                    notes: description,
                    invoiceNumber: invoiceNumber,
                    totalPrice: document.getElementById('totalPrice').textContent.replace(/,/g, ''),
                    timeline: '',
                    source: 'Client Quote Form',
                    submittedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Submit to Firebase
                const requestRef = database.ref('requests').push();
                await requestRef.set(quoteData);
                
                // Success
                successMsg.classList.add('show');
                submitBtn.innerHTML = '‚úì Submitted!';
                
                // Scroll to top smoothly so user sees success message (especially on mobile)
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                // Also scroll the container to top as backup
                document.querySelector('.container').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Reset form after delay
                setTimeout(() => {
                    if (confirm('Submit another quote request?')) {
                        location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Submission error:', error);
                document.getElementById('errorText').textContent = `Error: ${error.message}`;
                errorMsg.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit Request';
            }
        });
        
        // Trigger initial visibility
        document.getElementById('filmingRateType').dispatchEvent(new Event('change'));
    </script>
</body>
</html>
